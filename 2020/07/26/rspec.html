<!doctype html> <html> <head> <meta charset=utf-8 /> <meta http-equiv=X-UA-Compatible content='ie=edge'/> <meta name=viewport content="width=device-width, initial-scale=1, shrink-to-fit=no"/> <title>Blog Title - rspec</title> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/feed.xml"/> <link href="/note/assets/stylesheets/app-524c795c.css" rel=stylesheet /> <script src="/note/assets/javascripts/app-eaf002be.js"></script> </head> <body> <div id=main role=main> <nav class="navbar navbar-expand-lg navbar-light bg-light"> <a class=navbar-brand href="/note/">タイトル</a> <button class=navbar-toggler type=button data-toggle=collapse data-target="#navbarNav" aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation"> <span class=navbar-toggler-icon></span> </button> <div class="collapse navbar-collapse" id=navbarNav> <ul class=navbar-nav> <li class=nav-item> <a class="nav-link active" href="/note/">トップページ</a> </li> <li class=nav-item> <a class=nav-link href="/note/note.html">技術ノート</a> </li> </ul> </div> </nav> <div class="container article-outside-container"> <div class=row> <div class="col-md-8 blog-main"> <h3> rspec </h3> <hr> <h2>modelのテスト</h2> <h2>正常系と異常系</h2> <p>filepath: spec/models/contact_spec.rb</p> <pre><code>require &#39;rspec_helper&#39;

describe Contact do
  it &#39;firstname, lastname, emailがvalid&#39; do
    contact = Contact.new(
      firstname: &quot;tanaka&quot;,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
    expect(contact).to be_valid
  end
  it &#39;firstnameが無い場合invalid&#39; do
    contact = Contact.new(
      firstname: nil,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
    expect(contact).to have(1).error_on(:firstname)
  end
end
</code></pre> <h1>before、context使用する</h1> <pre><code>require &#39;rspec_helper&#39;

describe &#39;validation&#39; do
  before each do
    contact = Contact.new(
      firstname: nil,
      lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
  end
  context &#39;firstname, lastname, emailがvalid&#39; do
    it &#39;is_valid&#39; do
      expect(contact).to be_valid
    end
  end
  context &#39;firstnameがない場合&#39; do
    before each do
      contact.firstname = nil
    end
    it &#39;is_invalid&#39; do
      expect(contact).to have(1).error_on(:firstname)
    end
  end
end
</code></pre> <p>DRY(重複させない)</p> <p>describeが親contextが子</p> <p>親子関係でグルーピングさせる</p> <p>親で作成したテストデータは子でも使える</p> <p>beforeでまとめる</p> <p>親のbeforeで作られたテストデータが呼ばれた後に、子のbeforeが呼ばれ、</p> <p>contact.firstname = nilがテストデータにセットされる</p> <p>contactはローカル変数。contextの中のcontactメソッドが見つからないと エラーになるのでインスタンス変数に変更</p> <p>修正後</p> <pre><code>require &#39;rspec_helper&#39;

describe &#39;validation&#39; do
  before each do
    @contact = Contact.new(
      firstname: nil,
         lastname: &quot;manabu&quot;,
      email: &quot;tanaka@exmple.com&quot;
    )
  end
  context &#39;firstname, lastname, emailがvalid&#39; do
    it &#39;is_valid&#39; do
      expect(@contact).to be_valid
    end
  end
  context &#39;firstnameがない場合&#39; do
    before each do
      @contact.firstname = nil
    end
    it &#39;is_invalid&#39; do
      expect(@contact).to have(1).error_on(:firstname)
    end
  end
end
</code></pre> <h1>letを使用する</h1> <pre><code>require &#39;rspec_helper&#39;

describe &#39;validation&#39; do
  before each do
    let(:contact) { Contact.new
      (
        firstname: nil,
        lastname: &quot;manabu&quot;,
        email: &quot;tanaka@exmple.com&quot;
      )}
  end
  context &#39;firstname, lastname, emailがvalid&#39; do
    it &#39;is_valid&#39; do
        expect(@contact).to be_valid
    end
  end
  context &#39;firstnameがない場合&#39; do
    before each do
      contact.firstname = nil
    end
    it &#39;is_invalid&#39; do
      expect(contact).to have(1).error_on(:firstname)
    end
  end
end
</code></pre> </div> <aside class="col-md-4 blog-sidebar"> <div class="p-3 mb-3 bg-light rounded"> <h4 class=font-italic>目標</h4> <p class=mb-0> Rspecを中心に技術を学習する </p> </div> <div class=p-3> <h4 class=font-italic>最新投稿</h4> <ol class=list-unstyled> <li> <span>2020/07/26</span> <a href="/note/2020/07/26/rspec.html">rspec</a> </li> <li> <span>2020/07/25</span> <a href="/note/2020/07/25/expression.html">正規表現</a> </li> <li> <span>2020/07/24</span> <a href="/note/2020/07/24/kankyou.html">環境変数について</a> </li> <li> <span>2020/07/23</span> <a href="/note/2020/07/23/syashin.html">写真を添付テスト</a> </li> <li> <span>2020/07/22</span> <a href="/note/2020/07/22/middleman.html">middlemanとgithubの連携</a> </li> </ol> </div> <div class=p-3> <h4 class=font-italic>タグ</h4> <ol class=list-unstyled> <li> <a href="/note/tags/rspec.html">rspec (1)</a> </li> </ol> </div> <div class=p-3> <h4 class=font-italic>年別</h4> <ol class=list-unstyled> <li> <a href="/note/2020.html">2020 (5)</a> </li> </ol> </div> </aside> </div> </div> <footer class=my-footer> <p></p> </footer> </div> </body> </html>